<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  stroke: #000;
}

.node {
  stroke: #fff;
}

#svgMain {margin-left:auto; margin-right:auto; display:block;}

</style>
<body>

    <center><div id="svgMain"></div></center>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var width = window.innerWidth,
    height = window.innerHeight;

var svg = d3.select("#svgMain").append("svg")
    .attr("width", width)
    .attr("height", height);

var force = d3.layout.force()
    .size([width, height])
    .charge(-500)
    .linkDistance(120);


d3.csv("data.csv", function(error, links) {
  if (error) throw error;

  var nodesByName = {};
    console.log(links)
  // Create nodes for each unique source and target.
  links.forEach(function(link) {
    link.source = nodeByName(link.source, type='people');
    link.target = nodeByName(link.target, type='group');
  });

  console.log(nodesByName)
  
  
  var color = {
      "GT Saneamento" : "#40bfc1",
      "GT Mobilização" : "#f5f0e3",
      "GT Coordenação" : "#ff6f5e",
      "GT Cidade" : "#f0134d"
  }
  
  
  
  // Extract the array of nodes from the map by name.
  var nodes = d3.values(nodesByName);

  // Create the link lines.
  var link = svg.selectAll(".link")
      .data(links)
    .enter().append("line")
      .attr("class", "link")
      .style("stroke", function (d) { return color[d.target.name] || "#eee" ;});

  var cfg = {
      'group' : {
          'r' : 48,
          'fill' : 'red',
          'size' : '18px',
          'opacity' : 1,
      },
      'people' : {
          'r' : 4,
          'fill' : 'black',
          'size' : '12px',
          'opacity' : .7
      }
  }

  // Create the node circles.


  var node = svg.append("g")
    .attr("class", "nodes")
    .selectAll("nodes")
    .data(nodes)
    .enter()
    .append("g")
    .attr("class", "node");

  var circle = node.append("circle")
      .attr("class", "node")
      .attr("r", function (d) { return cfg[d.type]['r'];})
      .attr("stroke", function (d) { return cfg[d.type]['fill'];})
      .attr("stroke-width", 3)
      .attr("fill", function (d) { return color[d.name] || "#eee" ;})
      .attr("fill-opacity", function (d) { return cfg[d.type]['opacity'];})
      .call(force.drag);


  var text = node.append("text")
    .style("text-anchor", "middle")
    .attr("y", 15)
    .attr("stroke", "black")
    .attr('background-color', '#fff')
    .style("font-size", function (d) { return cfg[d.type]['size'];})
    .style( "fill-opacity", .7 )
    .text(function(d) {
      return d.name
    });

  // Start the force layout.
  force
      .nodes(nodes)
      .links(links)
      .on("tick", tick)
      .start();

  function tick() {
    link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

    node
      .attr("transform", function (d) { return "translate(" + d.x +"," + d.y + ") rotate(10)"});

  }

  function nodeByName(name, type) {
    return nodesByName[name] || (nodesByName[name] = {name: name, type: type});
  }
});

</script>